<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task PUBLIC "-//OASIS//DTD DITA Task//EN" "task.dtd" [
]>
<task id="task_c5k_tsc_d3b"><title>Configure Apache CouchDB Settings</title><shortdesc>Apache CouchDB is a document storage application that stores the documents used in a route. This topic describes how to configure the Apache CouchDB settings so that it works with Plant Applications.</shortdesc><taskbody><prereq>
            <ul><li>Install Apache CouchDB version 2.3.1.</li><li>Install Postman.</li><li>If you want to use the https protocol: <ol><li>Create a folder in the <filepath>CouchDB</filepath> folder.</li><li>In the folder that you have created, place the certificate and key files that you want to use for the https protocol.</li></ol></li><li>Create an Administrator user for Apache CouchDB with the same username as for UAA.</li></ul>
        </prereq><steps><step><cmd>Access the <filepath>default.ini</filepath> file located in the following folder: <filepath>&lt;installation folder for Apache CouchDB>/etc</filepath></cmd></step><step><cmd>Enter values for parameters as described in the following table.</cmd><info>
                    <table frame="all"><tgroup cols="3"><colspec colname="c1" colwidth="1*" colnum="1"/><colspec colname="c2" colwidth="1*" colnum="2"/><colspec colname="newCol3" colwidth="1*" colnum="3"/><thead><row><entry>Section</entry><entry>Parameter</entry><entry>Description</entry></row></thead><tbody><row><entry morerows="2">chttpd</entry><entry>port</entry><entry>Enter the port number that you want to use for Apache CouchDB.</entry></row><row><entry>bind_address</entry><entry>Enter the IP address of the machine on which you have installed Apache CouchDB. If, however, you have installed Apache CouchDB via Docker, comment out this line.</entry></row><row><entry>authentication_handlers</entry><entry>Perform the following steps to enable proxy authentication:<ol><li>Comment out the following line: <filepath>authentication_handlers = {chttpd_auth, cookie_authentication_handler}, {chttpd_auth, default_authentication_handler}</filepath></li><li>Uncomment the following line: <filepath>authentication_handlers = {chttpd_auth, proxy_authentication_handler}, {chttpd_auth, cookie_authentication_handler}, {chttpd_auth, default_authentication_handler}</filepath></li></ol></entry></row><row><entry morerows="1">httpd</entry><entry>port</entry><entry>Enter the port number that you want to use for Apache CouchDB.</entry></row><row><entry>enable_cors</entry><entry>Enter true to enable cross-origin errors.</entry></row><row><entry morerows="2">cors</entry><entry>origins</entry><entry>Enter the IP address of the machine on which Plant Applications is installed.</entry></row><row><entry>headers</entry><entry>Enter <codeph>content-type,if-match,x-auth-couchdb-token,x-auth-couchdb-username,x-couch-full-commit</codeph>.</entry></row><row><entry>methods</entry><entry>Enter <codeph>GET, POST, PUT</codeph>.</entry></row></tbody></tgroup></table>
                </info></step><step><cmd>Access the <filepath>local.ini</filepath> file located in the following folder: <filepath>&lt;installation folder for Apache CouchDB>/etc</filepath></cmd></step><step><cmd>Enter values for parameters as described in the following table.</cmd><info>
                    <table frame="all"><tgroup cols="3"><colspec colname="c1" colwidth="1*" colnum="1"/><colspec colname="c2" colwidth="1*" colnum="2"/><colspec colname="newCol3" colwidth="1*" colnum="3"/><thead><row><entry>Section</entry><entry>Parameter</entry><entry>Description</entry></row></thead><tbody><row><entry morerows="2">chttpd</entry><entry>port</entry><entry>Enter the port number that you want to use for Apache CouchDB.</entry></row><row><entry>bind_address</entry><entry>Enter the IP address of the machine on which you have installed Apache CouchDB. If, however, you have installed Apache CouchDB via Docker, comment out this line.</entry></row><row><entry>authentication_handlers</entry><entry>Perform the following steps to enable proxy authentication:<ol><li>Comment out the following line: <filepath>authentication_handlers = {chttpd_auth, cookie_authentication_handler}, {chttpd_auth, default_authentication_handler}</filepath></li><li>Uncomment the following line: <filepath>authentication_handlers = {chttpd_auth, proxy_authentication_handler}, {chttpd_auth, cookie_authentication_handler}, {chttpd_auth, default_authentication_handler}</filepath></li></ol></entry></row><row><entry morerows="2">ssl</entry><entry>enable</entry><entry>Enter true to allow the usage of the https protocol.</entry></row><row><entry>cert_file</entry><entry>Enter the file path of the certificate file in the following format: <filepath>./&lt;folder name>/&lt;name of the certificate file>.crt</filepath>.</entry></row><row><entry>key_file</entry><entry>Enter the file path of the key file in the following format: <filepath>./&lt;folder name>/&lt;name of the key file>.key</filepath></entry></row><row><entry morerows="2">cors</entry><entry>origins</entry><entry>Enter the IP address of the machine on which Plant Applications is installed.</entry></row><row><entry>headers</entry><entry/></row><row><entry>methods</entry><entry>Enter GET, POST, and PUT.</entry></row><row><entry morerows="1">couch_httpd_auth</entry><entry>require_valid_user</entry><entry>Enter true to prompt users to enter their user name and password to access Apache CouchDB.<note type="important">You must create at least one user before you enter true for this parameter.</note></entry></row><row><entry>secret</entry><entry>Enter a value without a space or special characters to allow proxy authentication.</entry></row><row><entry>httpd</entry><entry>WWW-Authenticate</entry><entry>Uncomment the following line: <filepath>WWW-Authenticate = Basic realm="administrator"</filepath></entry></row></tbody></tgroup></table>
                </info></step><step><cmd>Save the <filepath>local.ini</filepath> and <filepath>default.ini</filepath> files.</cmd></step><step><cmd>Restart Apache CouchDB.</cmd></step></steps><result>Apache CouchDB settings are now configured. You can view all the changes that you have made by accessing Apache CouchDB.</result><postreq>
            <ol><li>Create a database using the following details. <table><tgroup cols="2"><thead><row><entry>Details</entry><entry>Description</entry></row></thead><tbody><row><entry>API</entry><entry>Use the following API: https://yourCouchDBIp:couchDBPort/db_name /\</entry></row><row><entry>Method</entry><entry>Use the following method: PUT</entry></row><row><entry>Authentication</entry><entry>Enter Basic auth (that is, only the user name and password are required).</entry></row></tbody></tgroup></table>
                </li><li>If you have installed Apache CouchDB on a Linux machine, create views using the following details. <table><tgroup cols="2"><thead><row><entry>Details</entry><entry>Description</entry></row></thead><tbody><row><entry>API</entry><entry>Use the following API: https://yourCouchDBIp:couchDBPort/db_name /_design/DocumentMetaDetails</entry></row><row><entry>Method</entry><entry>Use the following method: PUT</entry></row><row><entry>Payload</entry><entry>Enter the following lines of code for the payload:<codeblock>{
  "_id": "_design/DocumentMetaDetails",
   "views": {
             "all": {
                     "map": "function (doc) {\n  if(doc.url != \"\"){\n  emit(null, doc);\n  }\n}"
                    },
             "by_revisionId": {
                     "reduce": "_count",
                     "map": "function (doc) {\n  emit(doc.documentName, doc);\n}"
                     },
              "by_documentName": {
                     "map": "function (doc) {\n  if(doc.url != \"\"){\n  emit(doc.documentName, doc);\n  }\n}"
                     },
              "by_routeID": {
                     "map": "function (doc) {\r\n\t\t\tif(doc.routeID.length > 0) 
                                                {\r\n\t\t\t for(var idx in doc.routeID) 
                                                    { \r\n\t\t\t          
                                                    if(doc.url!=\"\"){\r\n\t\t\t 
                                                    emit(doc.routeID[idx], doc);\r\n\t\t\t
                                                    }
                                                \r\n\t\t\t
                                                }
                                                \r\n\t\t\t
                                            }
                                            \r\n\t\t\t}"
                                            }
              },
   "language": "javascript"
}</codeblock></entry></row><row><entry>Authentication</entry><entry>Enter Basic auth (that is, only the user name and password are required).</entry></row></tbody></tgroup></table>
                </li></ol>
        </postreq></taskbody></task>